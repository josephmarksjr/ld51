pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- jam: ludum dare 51
-- theme: every ten seconds
-- date: 9/30/2022-10/2/2022

t=0
s=0
px=4
py=4
b={}
pb={}
f={}
--0=r,1=l,2=u,3=d
d=0
w={}
gameover=false
odd=true

function _init()
	init_game()
end

function reset_pb()
 pb={
	 x=1+flr(rnd(14)),
	 y=2+flr(rnd(13))
	}
end

function splode()
 add(f,{x=px,y=py,s=0})
 add(f,{x=px-1,y=py,s=0})
 add(f,{x=px+1,y=py,s=0})
 add(f,{x=px,y=py+1,s=0})
 add(f,{x=px,y=py-1,s=0})
 del(b,b[1])
 
 t=1
end

function init_game()
 gameover=false
 odd=true
 t=1
 f={}
 px=4
 py=4
	reset_pb()
 
 --init walls
 for i=0,15 do
  for j=1,15 do
   if(
    i==0 or i==15 or j==1
    or j==15
   )then
    add(w,{x=i,y=j})
   end
  end
 end
end

function add_bomb()
 add(b,{x=nil,y=nil})
end

function update_game()
	s+=(1/5)
	odd=(flr(t)%2==0)
	opx=px
 opy=py
	if(s>1)then
	 if(d==0)then
   px-=1
  elseif(d==1)then
   px+=1
  elseif(d==2)then
   py-=1
  elseif(d==3)then
   py+=1
  end
  
  skip=false
	 obx=nil
	 oby=nil
	 nbx=opx
	 nby=opy
	 for bb in all(b) do
	  if(skip==false)then
	   if(bb.x==nil)then
	    bb.x=opx
	    bb.y=opy
	    skip=true
	   else
	    obx=bb.x
	    oby=bb.y
	    bb.x=nbx
	    bb.y=nby
	    nbx=obx
	    nby=oby
	   end
	  end
	 end
  
	 s=0
	end
 
 if(btnp(❎))then
  --add_bomb()
  --del(b,b[1])
  splode()
 end
	
	nt=t+(1/30)
 if(nt>=11)then
  --reached ten seconds
  splode()
 else
  t=nt
 end
 
 if(btnp(0) and d!=1)then
  d=0
 elseif(btnp(1) and d!=0)then
  d=1
 elseif(btnp(2) and d!=3)then
  d=2
 elseif(btnp(3) and d!=4)then
  d=3
 end
 
 if(px==pb.x and py==pb.y)then
  add_bomb()
  reset_pb()
 end
 
 for ff in all(f) do
  ff.s+=0.01
  if(ff.s>10)then
   del(f,ff)
  end
 end
 
 --check collisions with player
 for ww in all(w) do
  if(ww.x==px and ww.y==py)then
   gameover=true
  end
 end
 for ff in all(f) do
  if(ff.x==px and ff.y==py)then
   if(t>2)then
    gameover=true
   end
  end
 end
 for bb in all(b) do
  if(bb.x==px and bb.y==py)then
   gameover=true
  end
 end
end

function _update()
 if(gameover==true)then
  -- check to restart
  if(btn(0))then
   init_game()
  end
 else
  update_game()
 end 
end

function _draw()
 cls()
 print(flr(t),1,1,7)
 --ps=1
 --if((t-flr(t))<0.2)then
   --ps=2
 --end
 
 for ww in all(w) do
  spr(16,ww.x*8,ww.y*8)
 end 
 
 for bb in all(b) do
  if(bb.x!=nil and bb.y!=nil)then
   spr(2,bb.x*8,bb.y*8)
  end
 end
 
 for ff in all(f) do
  fsp=32
  if(ff.s>6.66)then
   fsp=36
  elseif(ff.s>3.33)then
   fsp=34
  end
  
  if(odd==true)then
   fsp+=1
  end
  
  spr(fsp,ff.x*8,ff.y*8)
 end
 
 spr(1,pb.x*8,pb.y*8)
 spr(1,px*8,py*8)
 
 if(flr(t)<2)then
  spr(3,px*8,py*8)
 end
 
 if(gameover==true)then
  cls()
  print("gameover",1,1,7)
 end
end
__gfx__
00000000001111090000000000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111100011110007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700118118110111111070000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111110111111070000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000111111110111111070000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111111110111111070000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111100011110007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001111000000000000777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88188888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111100cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
888881880ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
888881880ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
888881880ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111110ccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88188888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88188888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00800800080080080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900900090090090900900900900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88988988898898890900900900900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
89989989899899890990990909909909008008000800800000000000000000000000000000000000000000000000000000000000000000000000000000000000
89989989899899898998998989989989088088000880880000000000000000000000000000000000000000000000000000000000000000000000000000000000
99a99a9999a99a9999a99a999a99a99a0a98a98009a89a8000000000000000000000000000000000000000000000000000000000000000000000000000000000
9aa9aa9a9aa9aa9a9aa9aa9a9aa9aa9a0aa8aa800aa8aa8000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
